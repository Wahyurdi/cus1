<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScanFinity</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.2/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>

    :root {
        --pink-light: #ffcfe0;
        --pink-medium: #ff9ebb;
        --pink-dark: #ff6b9a;
        --pink-darker: #ff4980;
        --pink-darkest: #e02b62;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--pink-light);
        margin: 0;
        padding: 0;
        overflow-x: hidden; /* Pastikan tidak ada overflow horizontal */
        width: 100%; /* Pastikan body tidak lebih lebar dari viewport */
         max-width: 100vw;
            box-sizing: border-box;
    }
    
   
    
    .content {
        position: relative;
        z-index: 1;
        padding-top: 2rem;
    }
    
    .main-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 1rem;
        padding-top: 4rem;
        width: 100%; /* Pastikan kontainer utama tidak lebih lebar dari viewport */
    }
    
    .content-card {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(255, 107, 154, 0.3);
        padding: 2rem;
        width: 100%;
        max-width: 720px;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        text-align: center;
        margin-bottom: 2rem;
        box-sizing: border-box; /* Tambahkan ini untuk menghindari masalah padding */
    }
    
    .content-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(255, 107, 154, 0.4);
    }
    
    .welcome-heading {
        font-size: 2rem;
        font-weight: 700;
        color: var(--pink-dark);
        margin-bottom: 1rem;
    }
    
    .welcome-text {
        font-size: 1.1rem;
        color: #555;
        margin-bottom: 2rem;
    }
    
    .glitter {
        position: absolute;
        width: 8px;
        height: 8px;
        background-color: white;
        border-radius: 50%;
        opacity: 0.6;
        animation: glitter 6s infinite linear;
        z-index: 5;
    }
    
    @keyframes glitter {
        0% { transform: translateY(0) scale(0); opacity: 0; }
        50% { transform: translateY(-100px) scale(1); opacity: 0.8; }
        100% { transform: translateY(-200px) scale(0); opacity: 0; }
    }
    
    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 10px rgba(255, 107, 154, 0.2);
        z-index: 100;
        padding: 0.5rem 1rem; /* Mengurangi padding untuk responsivitas */
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
    }

    .navbar-brand {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--pink-dark);
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .navbar-icons {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        transition: all 0.3s ease;
    }

    .nav-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 38px;
        height: 38px;
        border-radius: 50%;
        background: linear-gradient(45deg, var(--pink-dark), var(--pink-medium));
        color: white;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(255, 107, 154, 0.3);
        position: relative;
        overflow: hidden;
    }

    .nav-icon i {
        font-size: 1.2rem;
        transition: all 0.3s ease;
        z-index: 2;
    }

    .nav-icon::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.2);
        transition: all 0.4s ease;
        z-index: 1;
    }

    .nav-icon:hover::before {
        left: 100%;
    }

    .nav-icon:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(255, 107, 154, 0.5);
    }

    .nav-icon:active {
        transform: translateY(0);
        box-shadow: 0 3px 8px rgba(255, 107, 154, 0.4);
    }

    .home-icon:hover {
        background: linear-gradient(45deg, var(--pink-darkest), var(--pink-dark));
    }

    .ig-icon:hover {
        background: linear-gradient(45deg, #833AB4, #FD1D1D, #FCAF45);
    }

    /* Label untuk ikon pada layar yang lebih besar */
    .nav-icon .icon-label {
        display: none;
        margin-left: 8px;
        font-size: 0.85rem;
        font-weight: 600;
        color: white;
    }

    /* Animasi untuk ikon */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.15); }
        100% { transform: scale(1); }
    }

    /* Ketika navbar di-scroll ke bawah (bisa ditambahkan dengan JavaScript) */
    .navbar.scrolled {
        padding: 0.3rem 1rem;
        background-color: rgba(255, 255, 255, 0.95);
        box-shadow: 0 3px 10px rgba(255, 107, 154, 0.3);
    }

    /* Responsive Styles - Ditingkatkan */
    @media screen and (min-width: 992px) {
        /* Pada layar besar, tambahkan animasi hover yang lebih menarik */
        .nav-icon:hover i {
            animation: pulse 1s infinite;
        }
        
        /* Efek hover yang lebih halus */
        .navbar-brand:hover {
            color: var(--pink-darker);
            transform: translateY(-2px);
        }
    }

    @media screen and (min-width: 768px) and (max-width: 991px) {
        .navbar {
            padding: 0.5rem 1.5rem;
        }
        
        .nav-icon {
            width: 36px;
            height: 36px;
        }
        
        .nav-icon i {
            font-size: 1.1rem;
        }
    }

    @media screen and (min-width: 576px) and (max-width: 767px) {
        .navbar {
            padding: 0.4rem 1rem;
        }
        
        .navbar-brand {
            font-size: 1.3rem;
        }
        
        .nav-icon {
            width: 34px;
            height: 34px;
        }
        
        .nav-icon i {
            font-size: 1rem;
        }
        
        .navbar-icons {
            gap: 0.8rem;
        }
    }

    @media screen and (max-width: 575px) {
        .navbar {
            padding: 0.3rem 0.8rem;
        }
        
        .navbar-brand {
            font-size: 1.2rem;
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .nav-icon {
            width: 32px;
            height: 32px;
        }
        
        .nav-icon i {
            font-size: 0.9rem;
        }
        
        .navbar-icons {
            gap: 0.6rem;
        }
    }

    /* Handle untuk orientasi landscape pada perangkat mobile */
    @media screen and (max-height: 500px) and (orientation: landscape) {
        .navbar {
            padding: 0.2rem 1rem;
        }
        
        .nav-icon {
            width: 30px;
            height: 30px;
        }
        
        .nav-icon i {
            font-size: 0.85rem;
        }
    }

    /* Opsi tampilan label pada layar lebih besar (opsional) */
    @media screen and (min-width: 1200px) {
        .nav-icon {
            width: auto;
            border-radius: 20px;
            padding: 0 15px;
        }
        
        .nav-icon .icon-label {
            display: inline-block;
        }
    }
    
    /* Added responsiveness for screens below 1213px */
    @media (max-width: 1213px) {
        .content-card {
            max-width: 90%;
            padding: 1.5rem;
        }
        
        .content {
            padding: 1rem;
        }
    }
    
    @media (max-width: 640px) {
        .content-card {
            padding: 1.5rem;
            max-width: 95%;
        }
        
        .welcome-heading {
            font-size: 1.7rem;
        }
        
        .welcome-text {
            font-size: 1rem;
        }
    }
    
    /* Puzzle game styles */
    .puzzle-container {
        position: relative;
        margin: 0 auto;
        max-width: 100%; /* Ubah ini untuk memastikan tidak lebih lebar dari kontainer */
        aspect-ratio: 1 / 1;
    }
    
    .puzzle-board {
        display: grid;
        width: 100%;
        height: 100%;
        gap: 2px;
        background-color: var(--pink-medium);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 0 15px rgba(255, 75, 128, 0.5);
    }
    
    .puzzle-piece {
        position: relative;
        cursor: pointer;
        overflow: hidden;
        border-radius: 4px;
        transition: all 0.2s ease;
        box-shadow: 0 0 5px rgba(0,0,0,0.1);
        border: 2px solid white;
        width: 100%; /* Pastikan potongan puzzle mengisi ruang */
        height: 100%; /* Pastikan potongan puzzle mengisi ruang */
    }
    
    .puzzle-piece:hover {
        transform: scale(0.97);
        box-shadow: 0 0 8px rgba(255, 75, 128, 0.7);
    }
    
    .puzzle-image {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: cover; /* Pastikan gambar mengisi ruang dengan baik */
        pointer-events: none;
    }
    
    .puzzle-preview {
        max-width: 150px;
        border-radius: 8px;
        margin: 1rem auto;
        box-shadow: 0 0 10px rgba(255, 75, 128, 0.3);
        border: 3px solid white;
        transition: transform 0.3s ease;
    }
    
    .puzzle-preview:hover {
        transform: scale(1.1);
    }
    
    .button-pink {
        background-color: var(--pink-dark);
        color: white;
        padding: 0.5rem 1.5rem;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        outline: none;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(255, 107, 154, 0.3);
        margin: 0.5rem;
    }
    
    .button-pink:hover {
        background-color: var(--pink-darker);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(255, 107, 154, 0.4);
    }
    
    .button-pink:active {
        transform: translateY(0);
        box-shadow: 0 2px 5px rgba(255, 107, 154, 0.4);
    }
    
    .level-selector {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin: 1rem 0;
        gap: 0.5rem;
    }
    
    .level-button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        background-color: white;
        color: var(--pink-dark);
        cursor: pointer;
        box-shadow: 0 3px 8px rgba(255, 107, 154, 0.2);
        transition: all 0.2s ease;
        border: 2px solid var(--pink-medium);
    }
    
    .level-button:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(255, 107, 154, 0.3);
    }
    
    .level-button.active {
        background-color: var(--pink-dark);
        color: white;
        border: 2px solid white;
    }
    
    .level-button.completed {
        background-color: var(--pink-medium);
        color: white;
    }
    
    .timer {
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--pink-dark);
        margin: 1rem 0;
    }
    
    .moves {
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--pink-dark);
        margin: 1rem 0;
    }
    
    .victory-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        background-color: rgba(255, 255, 255, 0.8);
        animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .victory-message {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--pink-darker);
        text-shadow: 0 0 10px rgba(255, 107, 154, 0.5);
        animation: bounce 1s infinite;
    }
    
    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-20px); }
    }
    
    .progress-container {
        height: 8px;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: 4px;
        margin: 0.5rem 0;
        overflow: hidden;
    }
    
    .progress-bar {
        height: 100%;
        background-color: var(--pink-dark);
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    
    .shimmer-effect {
        position: relative;
        overflow: hidden;
    }
    
    .shimmer-effect::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
            to right,
            rgba(255, 255, 255, 0) 0%,
            rgba(255, 255, 255, 0.3) 50%,
            rgba(255, 255, 255, 0) 100%
        );
        transform: rotate(30deg);
        animation: shimmer 3s infinite linear;
    }
    
    @keyframes shimmer {
        0% { transform: translateX(-100%) rotate(30deg); }
        100% { transform: translateX(100%) rotate(30deg); }
    }
    
    /* Enhanced image gallery for level selection */
    .image-gallery {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin: 1rem 0;
    }
    
    .gallery-item {
        width: 100px;
        height: 100px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(255, 75, 128, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
        border: 3px solid transparent;
        position: relative;
    }
    
    .gallery-item:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 12px rgba(255, 75, 128, 0.5);
    }
    
    .gallery-item.active {
        border-color: var(--pink-dark);
    }
    
    .gallery-item-completed {
        position: absolute;
        top: 5px;
        right: 5px;
        width: 20px;
        height: 20px;
        background-color: var(--pink-darkest);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 12px;
        font-weight: bold;
    }
    
    .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: filter 0.3s ease;
    }
    
    .gallery-item:not(.active) img {
        filter: brightness(0.8);
    }
    
    .gallery-item-label {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(255, 75, 128, 0.7);
        color: white;
        font-size: 12px;
        padding: 4px;
        text-align: center;
    }
    
    /* Level progress indicators */
    .level-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: rgba(255, 255, 255, 0.7);
        border-radius: 20px;
        padding: 0.5rem 1rem;
        margin: 1rem 0;
        box-shadow: 0 2px 8px rgba(255, 75, 128, 0.2);
    }
    
    /* Confetti animation for victory */
    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: var(--pink-medium);
        opacity: 0.7;
        animation: confetti-fall 4s ease-in-out infinite;
    }
    
    @keyframes confetti-fall {
        0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
        100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }
    
    .confetti:nth-child(2n) {
        background-color: var(--pink-darker);
        width: 12px;
        height: 12px;
        animation-duration: 5s;
        animation-delay: 0.2s;
    }
    
    .confetti:nth-child(3n) {
        background-color: white;
        width: 8px;
        height: 8px;
        animation-duration: 3.5s;
        animation-delay: 0.5s;
    }
    
    /* Hints system */
    .hint-container {
        margin: 1rem 0;
    }
    
    .hint-button {
        background-color: rgba(255, 75, 128, 0.2);
        border: 1px dashed var(--pink-dark);
        color: var(--pink-darkest);
        padding: 0.3rem 1rem;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
    }
    
    .hint-button:hover {
        background-color: rgba(255, 75, 128, 0.3);
    }
    
    .hint-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 50;
        backdrop-filter: blur(3px);
    }
    
    .hint-preview {
        width: 80%;
        height: 80%;
        border-radius: 8px;
        border: 3px solid white;
        box-shadow: 0 0 20px rgba(255, 75, 128, 0.5);
    }
    
    /* Achievement badges */
    .achievements {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5rem;
        margin: 1rem 0;
    }
    
    .achievement-badge {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--pink-light);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        box-shadow: 0 2px 5px rgba(255, 75, 128, 0.3);
        position: relative;
        overflow: hidden;
    }
    
    .achievement-badge.earned {
        background-color: var(--pink-dark);
        color: white;
    }
    
    .achievement-tooltip {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background-color: white;
        border-radius: 8px;
        padding: 0.5rem;
        width: 150px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        z-index: 100;
        font-size: 0.8rem;
    }
    
    .achievement-badge:hover .achievement-tooltip {
        opacity: 1;
    }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .puzzle-container {
            max-width: 320px;
        }
        
        .puzzle-preview {
            max-width: 100px;
        }
        
        .button-pink {
            padding: 0.4rem 1.2rem;
            font-size: 0.9rem;
        }
        
        .level-button {
            width: 35px;
            height: 35px;
        }
        
        .gallery-item {
            width: 80px;
            height: 80px;
        }
    }
    
    @media (max-width: 480px) {
        .puzzle-container {
            max-width: 280px;
        }
        
        .level-button {
            width: 30px;
            height: 30px;
            font-size: 0.8rem;
        }
        
        .welcome-heading {
            font-size: 1.5rem;
        }
        
        .gallery-item {
            width: 70px;
            height: 70px;
        }
        
        .level-info {
            flex-direction: column;
            gap: 0.5rem;
        }
    }

    </style>
</head>
<body>
    <div id="root"></div>
    <!-- Popup iframe - now visible by default -->
    <iframe src="popup.html" style="border: none; position: fixed; bottom: 0; right: 0; width: 200px; height: 300px; z-index: 9999; background: none; pointer-events: all;" id="popup-frame"></iframe>
    <iframe src="music.html" style="display:none;"></iframe>
   <script>
    // Kode untuk menangani komunikasi dengan iframe
    window.addEventListener('message', function(event) {
        // Pastikan pesan berasal dari iframe popup
        if (event.data && event.data.action) {
            switch(event.data.action) {
                case 'navigate':
                    // Navigasi ke halaman yang dipilih
                    window.location.href = event.data.data;
                    break;
                case 'ready':
                    console.log('Pop-up menu siap');
                    break;
            }
        }
    });
</script>

<script type="text/babel">
   
    // Komponen Confetti untuk animasi kemenangan
    const Confetti = ({ count = 50 }) => {
        return (
            <>
                {Array.from({ length: count }).map((_, i) => {
                    const style = {
                        left: `${Math.random() * 100}%`,
                        top: `-10px`,
                        animationDelay: `${Math.random() * 3}s`,
                        transform: `rotate(${Math.random() * 360}deg)`,
                        width: `${5 + Math.random() * 10}px`,
                        height: `${5 + Math.random() * 10}px`,
                        borderRadius: Math.random() > 0.5 ? '50%' : `${Math.random() * 5}px`,
                        backgroundColor: [
                            'var(--pink-light)', 
                            'var(--pink-medium)', 
                            'var(--pink-dark)', 
                            'white', 
                            '#ffeb3b'
                        ][Math.floor(Math.random() * 5)]
                    };
                    
                    return <div key={i} className="confetti" style={style} />;
                })}
            </>
        );
    };
    
    const Navbar = () => {
        return (
            <nav className="navbar">
                <a href="#" className="navbar-brand">ScanFinity</a>
                <div className="navbar-icons">
                    <a href="layout.html" className="nav-icon home-icon" title="Home">
                        <i className="fas fa-home"></i>
                        <span className="icon-label">Home</span>
                    </a>
                    <a href="https://www.instagram.com/scanfinity?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" target="_blank" className="nav-icon ig-icon" title="Instagram">
                        <i className="fab fa-instagram"></i>
                        <span className="icon-label">Instagram</span>
                    </a>
                </div>
            </nav>
        );
    };
    
    // Komponen Puzzle Game
    const PuzzleGame = () => {
        // Level configurations
        const levels = [
            { id: 1, size: 3, image: './foto/p1.jpg', name: '1', completed: false },
            { id: 2, size: 3, image: './foto/p2.jpg', name: '2', completed: false },
                            { id: 3, size: 3, image: './foto/p3.jpg', name: '3', completed: false },
            { id: 4, size: 4, image: './foto/p4.jpg', name: '4', completed: false },
            { id: 5, size: 4, image: './foto/p5.jpg', name: '5', completed: false },
            { id: 6, size: 5, image: './foto/p6.jpg', name: '6', completed: false },
            { id: 7, size: 5, image: './foto/p7.jpg', name: '7', completed: false },
        ];
        
        // React states
        const [currentLevel, setCurrentLevel] = React.useState(1);
        const [gameBoard, setGameBoard] = React.useState([]);
        const [pieces, setPieces] = React.useState([]);
        const [isComplete, setIsComplete] = React.useState(false);
        const [moves, setMoves] = React.useState(0);
        const [timer, setTimer] = React.useState(0);
        const [completedLevels, setCompletedLevels] = React.useState([]);
        const [timerActive, setTimerActive] = React.useState(false);
        const [selectedPiece, setSelectedPiece] = React.useState(null);
        const [showHint, setShowHint] = React.useState(false);
        const [hintsUsed, setHintsUsed] = React.useState(0);
        const [bestTimes, setBestTimes] = React.useState({});
        const [bestMoves, setBestMoves] = React.useState({});
        const [achievements, setAchievements] = React.useState({
            speedster: false,
            efficient: false,
            persistent: false,
            collector: false
        });
        
        // Timer interval ref
        const timerRef = React.useRef(null);
        
        // Function to initialize the game board
        const initializeGame = (levelId) => {
            const level = levels.find(l => l.id === levelId);
            if (!level) return;
            
            const size = level.size;
            const totalPieces = size * size;
            
            // Create an array of piece indices
            let indices = Array.from({ length: totalPieces }, (_, i) => i);
            
            // Shuffle the indices
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            
            // Create pieces with shuffled positions
            const newPieces = indices.map((targetIndex, currentIndex) => {
                const targetX = targetIndex % size;
                const targetY = Math.floor(targetIndex / size);
                
                return {
                    id: currentIndex,
                    currentIndex,
                    targetIndex,
                    x: targetX,
                    y: targetY,
                };
            });
            
            setGameBoard(newPieces);
            setPieces(newPieces);
            setMoves(0);
            setTimer(0);
            setIsComplete(false);
            setTimerActive(true);
            setSelectedPiece(null);
            setShowHint(false);
            
            // Start the timer
            clearInterval(timerRef.current);
            timerRef.current = setInterval(() => {
                setTimer(prev => prev + 1);
            }, 1000);
        };
        
        // Handle piece click
        const handlePieceClick = (clickedIndex) => {
            if (isComplete) return;
            
            if (selectedPiece === null) {
                // First piece selected
                setSelectedPiece(clickedIndex);
            } else {
                // Second piece selected, swap them
                if (clickedIndex !== selectedPiece) {
                    const newPieces = [...pieces];
                    const temp = { ...newPieces[clickedIndex] };
                    
                    // Swap current indices
                    newPieces[clickedIndex] = { ...newPieces[selectedPiece], currentIndex: clickedIndex };
                    newPieces[selectedPiece] = { ...temp, currentIndex: selectedPiece };
                    
                    setPieces(newPieces);
                    setMoves(prev => prev + 1);
                    
                    // Check if puzzle is complete
                    const isCompleted = newPieces.every(piece => piece.currentIndex === piece.targetIndex);
                    if (isCompleted) {
                        handlePuzzleComplete();
                    }
                }
                
                // Reset selection
                setSelectedPiece(null);
            }
        };
        
        // Handle puzzle completion
        const handlePuzzleComplete = () => {
            setIsComplete(true);
            setTimerActive(false);
            clearInterval(timerRef.current);
            
            // Mark level as completed
            if (!completedLevels.includes(currentLevel)) {
                setCompletedLevels([...completedLevels, currentLevel]);
            }
            
            // Update best times and moves
            const currentBestTime = bestTimes[currentLevel] || Infinity;
            const currentBestMove = bestMoves[currentLevel] || Infinity;
            
            if (timer < currentBestTime) {
                setBestTimes({...bestTimes, [currentLevel]: timer});
            }
            
            if (moves < currentBestMove) {
                setBestMoves({...bestMoves, [currentLevel]: moves});
            }
            
            // Check achievements
            checkAchievements();
        };
        
        // Check for achievements
        const checkAchievements = () => {
            const newAchievements = {...achievements};
            
            // Speedster achievement: Complete a level in under 30 seconds
            if (timer < 30) {
                newAchievements.speedster = true;
            }
            
            // Efficient achievement: Complete a level in less than 20 moves
            if (moves < 20) {
                newAchievements.efficient = true;
            }
            
            // Persistent achievement: Play for over 5 minutes
            if (timer > 300) {
                newAchievements.persistent = true;
            }
            
            // Collector achievement: Complete 3 or more levels
            if (completedLevels.length >= 3) {
                newAchievements.collector = true;
            }
            
            setAchievements(newAchievements);
        };
        
        // Format time for display
        const formatTime = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        };
        
        // Reset the game
        const handleReset = () => {
            initializeGame(currentLevel);
        };
        
        // Change the level
        const handleLevelChange = (levelId) => {
            setCurrentLevel(levelId);
            initializeGame(levelId);
        };
        
        // Show hint
        const toggleHint = () => {
            if (!showHint) {
                setHintsUsed(hintsUsed + 1);
            }
            setShowHint(!showHint);
            
            // Hide hint after 3 seconds
            if (!showHint) {
                setTimeout(() => {
                    setShowHint(false);
                }, 3000);
            }
        };
        
        // Initialize the game when component mounts or level changes
        React.useEffect(() => {
            initializeGame(currentLevel);
            
            // Cleanup timer when component unmounts
            return () => {
                clearInterval(timerRef.current);
            };
        }, [currentLevel]);
        
        // Get current level information
        const currentLevelInfo = levels.find(l => l.id === currentLevel);
        const gridSize = currentLevelInfo ? currentLevelInfo.size : 3;
        
        return (
            <div className="content-card">
                <h1 className="welcome-heading">Photo Puzzle Game</h1>
                <p className="welcome-text">
                    Susun kembali potongan gambar untuk menyelesaikan puzzle. Klik dua potongan untuk menukar posisinya.
                </p>
                
                {/* Gallery style level selection */}
                <div className="image-gallery">
                    {levels.map(level => (
                        <div 
                            key={level.id}
                            className={`gallery-item ${currentLevel === level.id ? 'active' : ''}`}
                            onClick={() => handleLevelChange(level.id)}
                        >
                            <img src={level.image} alt={level.name} />
                            {completedLevels.includes(level.id) && (
                                <div className="gallery-item-completed">✓</div>
                            )}
                            <div className="gallery-item-label">Level {level.id}</div>
                        </div>
                    ))}
                </div>
                
                {/* Level info and progress */}
                <div className="level-info">
                    <div className="timer">⏱️ {formatTime(timer)}</div>
                    <div>
                        <strong>Level {currentLevel}: {currentLevelInfo?.name}</strong>
                        {bestTimes[currentLevel] && (
                            <div className="text-xs text-pink-600">Best: {formatTime(bestTimes[currentLevel])}</div>
                        )}
                    </div>
                    <div className="moves">🔄 {moves} langkah</div>
                </div>
                
                {/* Preview and hint controls */}
                <div className="flex justify-center items-center">
                    <img 
                        src={currentLevelInfo?.image} 
                        alt="Preview" 
                        className="puzzle-preview"
                        onClick={toggleHint} 
                    />
                    <div className="hint-container ml-2">
                        <button className="hint-button" onClick={toggleHint}>
                            💡 Petunjuk ({3 - hintsUsed})
                        </button>
                    </div>
                </div>
                
                {/* Puzzle container */}
                <div className="puzzle-container">
                    <div
                        className="puzzle-board"
                        style={{
                            gridTemplateColumns: `repeat(${gridSize}, 1fr)`,
                            gridTemplateRows: `repeat(${gridSize}, 1fr)`
                        }}
                    >
                        {pieces.map((piece) => {
                            // Calculate background position for this piece
                            const bgPosX = -(piece.x * (100 / (gridSize - 1))) + '%';
                            const bgPosY = -(piece.y * (100 / (gridSize - 1))) + '%';
                            const bgSize = `${gridSize * 100}%`;
                            
                            return (
                                <div
                                    key={piece.currentIndex}
                                    className={`puzzle-piece ${selectedPiece === piece.currentIndex ? 'shimmer-effect' : ''}`}
                                    onClick={() => handlePieceClick(piece.currentIndex)}
                                    style={{
                                        backgroundColor: selectedPiece === piece.currentIndex ? 'rgba(255, 107, 154, 0.3)' : '',
                                        transform: selectedPiece === piece.currentIndex ? 'scale(0.95)' : '',
                                        border: selectedPiece === piece.currentIndex ? '2px solid var(--pink-darker)' : ''
                                    }}
                                >
                                    <div 
                                        className="puzzle-image" 
                                        style={{
                                            backgroundImage: `url(${currentLevelInfo?.image})`,
                                            backgroundPosition: `${bgPosX} ${bgPosY}`,
                                            backgroundSize: bgSize
                                        }}
                                    />
                                </div>
                            );
                        })}
                    </div>
                    
                    {/* Hint overlay */}
                    {showHint && (
                        <div className="hint-overlay" onClick={toggleHint}>
                            <img 
                                src={currentLevelInfo?.image} 
                                alt="Hint" 
                                className="hint-preview" 
                            />
                        </div>
                    )}
                </div>
                
                {/* Achievements */}
                <div className="achievements">
                    <div className={`achievement-badge ${achievements.speedster ? 'earned' : ''}`}>
                        ⚡
                        <div className="achievement-tooltip">Speedster: Selesaikan level dalam 30 detik</div>
                    </div>
                    <div className={`achievement-badge ${achievements.efficient ? 'earned' : ''}`}>
                        🧩
                        <div className="achievement-tooltip">Efficient: Selesaikan level dengan kurang dari 20 langkah</div>
                    </div>
                    <div className={`achievement-badge ${achievements.persistent ? 'earned' : ''}`}>
                        ⏰
                        <div className="achievement-tooltip">Persistent: Main lebih dari 5 menit</div>
                    </div>
                    <div className={`achievement-badge ${achievements.collector ? 'earned' : ''}`}>
                        🏆
                        <div className="achievement-tooltip">Collector: Selesaikan 3 level atau lebih</div>
                    </div>
                </div>
                
                {/* Game controls */}
                <div className="mt-4 flex justify-center flex-wrap">
                    <button className="button-pink" onClick={handleReset}>
                        <span>🔄 Reset</span>
                    </button>
                    <button 
                        className="button-pink" 
                        onClick={() => {
                            if (currentLevel < levels.length) {
                                handleLevelChange(currentLevel + 1);
                            }
                        }}
                        disabled={currentLevel >= levels.length}
                    >
                        <span>⏭️ Level Selanjutnya</span>
                    </button>
                    <button 
                        className="button-pink" 
                        onClick={() => {
                            if (currentLevel > 1) {
                                handleLevelChange(currentLevel - 1);
                            }
                        }}
                        disabled={currentLevel <= 1}
                    >
                        <span>⏮️ Level Sebelumnya</span>
                    </button>
                </div>
                
                {/* Victory animation */}
                {isComplete && (
                    <div className="victory-animation" onClick={() => setIsComplete(false)}>
                        <Confetti count={100} />
                        <div className="victory-message">
                            <div>Selamat! 🎉</div>
                            <div className="text-xl">Level {currentLevel} Selesai</div>
                            <div className="text-lg">{formatTime(timer)} - {moves} langkah</div>
                            <button 
                                className="button-pink mt-4"
                                onClick={(e) => {
                                    e.stopPropagation();
                                    if (currentLevel < levels.length) {
                                        handleLevelChange(currentLevel + 1);
                                    } else {
                                        setIsComplete(false);
                                    }
                                }}
                            >
                                {currentLevel < levels.length ? 'Level Selanjutnya' : 'Tutup'}
                            </button>
                        </div>
                    </div>
                )}
            </div>
        );
    };
    
    // Main App component
    const App = () => {
       
        return (
            <div className="min-h-screen">
                <div className="background"></div>
                <Navbar />
                
             
                
                <div className="main-container">
                    <PuzzleGame />
                </div>
            </div>
        );
    };
    
    // Render application
    ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>